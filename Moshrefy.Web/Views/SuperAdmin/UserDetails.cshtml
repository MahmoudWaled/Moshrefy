@model Moshrefy.Web.Models.User.UserVM
@{
    ViewData["Title"] = "User Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Page header -->
<div class="page-header d-print-none">
  <div class="container-xl">
    <div class="row g-2 align-items-center">
      <div class="col">
        <div class="page-pretitle">Users</div>
        <h2 class="page-title"><i class="ti ti-user"></i> User Details</h2>
      </div>
      <div class="col-auto ms-auto">
        <a asp-action="Users" class="btn btn-secondary">
          <i class="ti ti-arrow-left"></i> Back to Users
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Page body -->
<div class="page-body">
  <div class="container-xl">
    <div class="row">
      <!-- User Information Card -->
      <div class="col-md-8">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="ti ti-info-circle me-2"></i>User Information</h3>
          </div>
          <div class="card-body">
            <div class="datagrid">
              <div class="datagrid-item">
                <div class="datagrid-title"><i class="ti ti-user text-primary me-1"></i>Full Name</div>
                <div class="datagrid-content"><strong>@Model.Name</strong></div>
              </div>
              <div class="datagrid-item">
                <div class="datagrid-title"><i class="ti ti-at text-info me-1"></i>Username</div>
                <div class="datagrid-content"><code>@Model.UserName</code></div>
              </div>
              <div class="datagrid-item">
                <div class="datagrid-title"><i class="ti ti-mail text-info me-1"></i>Email</div>
                <div class="datagrid-content">
                  @if (!string.IsNullOrEmpty(Model.Email)){<a href="mailto:@Model.Email">@Model.Email</a>}
                  else{<span class="text-muted">Not provided</span>}
                </div>
              </div>
              <div class="datagrid-item">
                <div class="datagrid-title"><i class="ti ti-phone text-success me-1"></i>Phone</div>
                <div class="datagrid-content">
                  @if (!string.IsNullOrEmpty(Model.PhoneNumber)){<a href="tel:@Model.PhoneNumber">@Model.PhoneNumber</a>}
                  else{<span class="text-muted">Not provided</span>}
                </div>
              </div>
              <div class="datagrid-item">
                <div class="datagrid-title"><i class="ti ti-building text-warning me-1"></i>Center</div>
                <div class="datagrid-content">
                  @if (!string.IsNullOrEmpty(Model.CenterName) && Model.CenterId.HasValue)
                  {<a asp-action="CenterDetails" asp-route-centerId="@Model.CenterId" class="badge bg-info"><i class="ti ti-building me-1"></i>@Model.CenterName</a>}
                  else{<span class="text-muted">No center assigned</span>}
                </div>
              </div>
              <div class="datagrid-item">
                <div class="datagrid-title"><i class="ti ti-tag text-purple me-1"></i>Role</div>
                <div class="datagrid-content">
                  @if (!string.IsNullOrEmpty(Model.RoleName))
                  {
                    var bgClass = Model.RoleName switch { "SuperAdmin" => "bg-role-superadmin", "Admin" => "bg-role-admin", "Manager" => "bg-role-manager", _ => "bg-role-employee" };
                    var icon = Model.RoleName switch { "SuperAdmin" => "ti-shield", "Admin" => "ti-tie", "Manager" => "ti-settings", _ => "ti-user" };
                    <span class="badge @bgClass"><i class="ti @icon me-1"></i>@Model.RoleName</span>
                  }
                  else{<span class="text-muted">No role</span>}
                </div>
              </div>
              <div class="datagrid-item">
                <div class="datagrid-title"><i class="ti ti-toggle-right text-success me-1"></i>Status</div>
                <div class="datagrid-content">
                  @if (Model.IsActive){<span class="badge bg-state-active"><i class="ti ti-check"></i> Active</span>}
                  else{<span class="badge bg-state-inactive"><i class="ti ti-x"></i> Inactive</span>}
                </div>
              </div>
              <div class="datagrid-item">
                <div class="datagrid-title"><i class="ti ti-info-circle text-info me-1"></i>State</div>
                <div class="datagrid-content">
                  @if (Model.IsDeleted){<span class="badge bg-action-delete"><i class="ti ti-trash"></i> Deleted</span>}
                  else{<span class="badge bg-state-active"><i class="ti ti-check"></i> Normal</span>}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Actions & Metadata Card -->
      <div class="col-md-4">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="ti ti-settings me-2"></i>Actions</h3>
          </div>
          <div class="card-body">
            <div class="d-grid gap-2">
              @if (!Model.IsDeleted)
              {
                <a asp-action="EditUser" asp-route-id="@Model.Id" class="btn btn-action-edit"><i class="ti ti-edit"></i> Edit User</a>
                <a asp-action="UpdateUserRole" asp-route-id="@Model.Id" class="btn btn-purple"><i class="ti ti-tag"></i> Update Role</a>
                @if (Model.IsActive)
                {<button class="btn btn-state-deactive" onclick="deactivate()"><i class="ti ti-ban"></i> Deactivate</button>}
                else
                {<button class="btn btn-state-active" onclick="activate()"><i class="ti ti-check"></i> Activate</button>}
                <button class="btn btn-action-delete" onclick="softDelete()"><i class="ti ti-trash"></i> Soft Delete</button>
                <button class="btn btn-action-delete" onclick="hardDelete()"><i class="ti ti-trash-x"></i> Hard Delete</button>
              }
              else
              {<button class="btn btn-state-restore" onclick="restore()"><i class="ti ti-refresh"></i> Restore User</button>}
            </div>
          </div>
        </div>
        <div class="card mt-3">
          <div class="card-header">
            <h3 class="card-title"><i class="ti ti-history me-2"></i>Metadata</h3>
          </div>
          <div class="card-body">
            <div class="datagrid">
              <div class="datagrid-item">
                <div class="datagrid-title"><i class="ti ti-clock me-1"></i>Created</div>
                <div class="datagrid-content">@Model.CreatedAt.ToString("MMM dd, yyyy hh:mm tt")</div>
              </div>
              @if (!string.IsNullOrEmpty(Model.CreatedByName))
              {
                <div class="datagrid-item">
                  <div class="datagrid-title"><i class="ti ti-user me-1"></i>Created By</div>
                  <div class="datagrid-content">@Model.CreatedByName</div>
                </div>
              }
              <div class="datagrid-item">
                <div class="datagrid-title"><i class="ti ti-id me-1"></i>User ID</div>
                <div class="datagrid-content text-break"><small>@Model.Id</small></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

@section Scripts {
    <script>
        function restore() { Swal.fire({ title: 'Restore?', html: '<strong>@Model.UserName</strong>', icon: 'question', showCancelButton: true, confirmButtonColor: '#28a745', confirmButtonText: '<i class="ti ti-refresh"></i> Restore' }).then((r)=>{if(r.isConfirmed){$.post('@Url.Action("RestoreUser"))', {id:'@Model.Id'}).done((res)=>{if(res.success){Swal.fire({icon:'success',title:'Restored!',timer:2000,showConfirmButton:false}).then(()=>location.reload());}else{Swal.fire('Error',res.message,'error');}});}}); }
        function activate() { Swal.fire({ title: 'Activate?', html: '<strong>@Model.UserName</strong>', icon: 'question', showCancelButton: true, confirmButtonColor: '#28a745', confirmButtonText: '<i class="ti ti-check"></i> Activate' }).then((r)=>{if(r.isConfirmed){$.post('@Url.Action("ActivateUser")', {id:'@Model.Id'}).done((res)=>{if(res.success){Swal.fire({icon:'success',title:'Activated!',timer:2000,showConfirmButton:false}).then(()=>location.reload());}else{Swal.fire('Error',res.message,'error');}});}}); }
        function deactivate() { Swal.fire({ title: 'Deactivate?', html: '<strong>@Model.UserName</strong>', icon: 'warning', showCancelButton: true, confirmButtonColor: '#ffc107', confirmButtonText: '<i class="ti ti-ban"></i> Deactivate' }).then((r)=>{if(r.isConfirmed){$.post('@Url.Action("DeactivateUser")', {id:'@Model.Id'}).done((res)=>{if(res.success){Swal.fire({icon:'success',title:'Deactivated!',timer:2000,showConfirmButton:false}).then(()=>location.reload());}else{Swal.fire('Error',res.message,'error');}});}}); }
        function softDelete() { Swal.fire({ title: 'Soft Delete?', html: '<strong>@Model.UserName</strong><br>Move to trash?', icon: 'warning', showCancelButton: true, confirmButtonColor: '#ffc107', confirmButtonText: '<i class="ti ti-trash"></i> Soft Delete' }).then((r)=>{if(r.isConfirmed){$.post('@Url.Action("SoftDeleteUser")', {id:'@Model.Id'}).done((res)=>{if(res.success){Swal.fire({icon:'success',title:'Deleted!',timer:2000,showConfirmButton:false}).then(()=>window.location.href='@Url.Action("Users")');}else{Swal.fire('Error',res.message,'error');}});}}); }
        function hardDelete() { Swal.fire({ title: 'PERMANENT DELETE', html: '<strong class="text-danger">WARNING</strong><br>Delete <strong>@Model.UserName</strong> forever?', icon: 'error', showCancelButton: true, confirmButtonColor: '#dc3545', confirmButtonText: '<i class="ti ti-trash-x"></i> DELETE' }).then((r)=>{if(r.isConfirmed){$.post('@Url.Action("HardDeleteUser")', {id:'@Model.Id'}).done((res)=>{if(res.success){Swal.fire({icon:'success',title:'Deleted!',timer:2000,showConfirmButton:false}).then(()=>window.location.href='@Url.Action("Users")');}else{Swal.fire('Error',res.message,'error');}});}}); }
    </script>
    <style>.bg-purple,.btn-purple{background-color:#6f42c1!important;color:white;}.btn-purple:hover{background-color:#5a32a3!important;}</style>
}
