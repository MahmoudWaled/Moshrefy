@model Moshrefy.Web.Models.Center.CenterVM
@{
    ViewData["Title"] = "Center Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Page header -->
<div class="page-header d-print-none">
  <div class="container-xl">
    <div class="row g-2 align-items-center">
      <div class="col">
        <div class="page-pretitle">Centers</div>
        <h2 class="page-title"><i class="ti ti-building"></i> Center Details</h2>
      </div>
      <div class="col-auto ms-auto">
        <a asp-action="Centers" class="btn btn-secondary">
          <i class="ti ti-arrow-left"></i> Back to List
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Page body -->
<div class="page-body">
  <div class="container-xl">
    <!-- Center Information Card -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title"><i class="ti ti-building me-2"></i>@Model.Name</h3>
        <div class="card-actions">
          @if (Model.IsActive)
          {
            <span class="badge bg-state-active"><i class="ti ti-check"></i> Active</span>
          }
          else
          {
            <span class="badge bg-state-inactive"><i class="ti ti-x"></i> Inactive</span>
          }
        </div>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <div class="datagrid">
              <div class="datagrid-item">
                <div class="datagrid-title"><i class="ti ti-id me-1"></i>ID</div>
                <div class="datagrid-content">@Model.Id</div>
              </div>
              <div class="datagrid-item">
                <div class="datagrid-title"><i class="ti ti-building me-1"></i>Name</div>
                <div class="datagrid-content">@Model.Name</div>
              </div>
              <div class="datagrid-item">
                <div class="datagrid-title"><i class="ti ti-phone me-1"></i>Phone</div>
                <div class="datagrid-content">@Model.Phone</div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="datagrid">
              <div class="datagrid-item">
                <div class="datagrid-title"><i class="ti ti-mail me-1"></i>Email</div>
                <div class="datagrid-content">
                  @if (!string.IsNullOrEmpty(Model.Email))
                  {
                    <a href="mailto:@Model.Email">@Model.Email</a>
                  }
                  else
                  {
                    <span class="text-muted">N/A</span>
                  }
                </div>
              </div>
              <div class="datagrid-item">
                <div class="datagrid-title"><i class="ti ti-map-pin me-1"></i>Address</div>
                <div class="datagrid-content">@Model.Address</div>
              </div>
              <div class="datagrid-item">
                <div class="datagrid-title"><i class="ti ti-toggle-right me-1"></i>Status</div>
                <div class="datagrid-content">
                  @if (Model.IsActive){<span class="badge bg-state-active"><i class="ti ti-check"></i> Active</span>}
                  else{<span class="badge bg-state-inactive"><i class="ti ti-x"></i> Inactive</span>}
                </div>
              </div>
            </div>
          </div>
        </div>
        @if (!string.IsNullOrEmpty(Model.Description))
        {
          <div class="mt-3">
            <h4><i class="ti ti-file-text me-1"></i>Description</h4>
            <p class="text-muted">@Model.Description</p>
          </div>
        }
      </div>
    </div>

    <!-- Audit Information Card -->
    <div class="card mt-3">
      <div class="card-header">
        <h3 class="card-title"><i class="ti ti-history me-2"></i>Audit Information</h3>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <div class="card bg-azure-lt">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <span class="avatar bg-azure text-white me-3"><i class="ti ti-user-plus"></i></span>
                  <div>
                    <strong>Created By</strong>
                    <div>@Model.CreatedByName</div>
                    <small class="text-muted"><i class="ti ti-clock me-1"></i>@Model.CreatedAt.ToLocalTime().ToString("MMM dd, yyyy 'at' hh:mm tt")</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            @if (Model.ModifiedAt.HasValue && !string.IsNullOrEmpty(Model.ModifiedByName))
            {
              <div class="card bg-yellow-lt">
                <div class="card-body">
                  <div class="d-flex align-items-center">
                    <span class="avatar bg-yellow text-white me-3"><i class="ti ti-user-edit"></i></span>
                    <div>
                      <strong>Last Modified By</strong>
                      <div>@Model.ModifiedByName</div>
                      <small class="text-muted"><i class="ti ti-clock me-1"></i>@Model.ModifiedAt.Value.ToLocalTime().ToString("MMM dd, yyyy 'at' hh:mm tt")</small>
                    </div>
                  </div>
                </div>
              </div>
            }
            else
            {
              <div class="card bg-secondary-lt">
                <div class="card-body">
                  <div class="d-flex align-items-center">
                    <span class="avatar bg-secondary text-white me-3"><i class="ti ti-user-edit"></i></span>
                    <div>
                      <strong>Last Modified</strong>
                      <div>Never Modified</div>
                      <small class="text-muted"><i class="ti ti-info-circle me-1"></i>No modifications yet</small>
                    </div>
                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      </div>
      <div class="card-footer">
        <div class="btn-list">
          <a asp-action="CenterUsers" asp-route-centerId="@Model.Id" class="btn btn-action-view">
            <i class="ti ti-users"></i> View Center Users
          </a>
          <a asp-action="EditCenter" asp-route-id="@Model.Id" class="btn btn-action-edit">
            <i class="ti ti-edit"></i> Edit
          </a>
          <button onclick="softDeleteCenter()" class="btn btn-action-delete">
            <i class="ti ti-trash"></i> Move to Trash
          </button>
          <button onclick="hardDeleteCenter()" class="btn btn-action-delete">
            <i class="ti ti-trash-x"></i> Permanent Delete
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

@section Scripts {
    <script>
        function softDeleteCenter() {
            Swal.fire({ title: 'Move to Trash?', html: '<strong>@Model.Name</strong> will be moved to trash.<br>You can restore it later.', icon: 'warning', showCancelButton: true, confirmButtonColor: '#f39c12', confirmButtonText: '<i class="ti ti-trash"></i> Move to Trash' })
            .then((r) => { if (r.isConfirmed) { $.post('@Url.Action("SoftDeleteCenter")', { id: @Model.Id }).done((res) => { if (res.success) { Swal.fire({ icon: 'success', title: 'Moved to Trash!', timer: 2000, showConfirmButton: false }).then(() => window.location.href = '@Url.Action("Centers")'); } else { Swal.fire('Error', res.message, 'error'); } }); } });
        }

        function hardDeleteCenter() {
            Swal.fire({ title: 'PERMANENT DELETE', html: '<div class="alert alert-danger mb-2"><strong>DANGER!</strong> This cannot be undone!</div>Type <code>DELETE</code> to confirm:', input: 'text', inputPlaceholder: 'Type DELETE', icon: 'warning', showCancelButton: true, confirmButtonColor: '#dc3545', confirmButtonText: '<i class="ti ti-trash-x"></i> PERMANENTLY DELETE', preConfirm: (v) => { if (v !== 'DELETE') { Swal.showValidationMessage('You must type DELETE to confirm'); } } })
            .then((r) => { if (r.isConfirmed) { $.post('@Url.Action("HardDeleteCenter")', { id: @Model.Id }).done((res) => { if (res.success) { Swal.fire({ icon: 'success', title: 'Deleted!', timer: 2000, showConfirmButton: false }).then(() => window.location.href = '@Url.Action("Centers")'); } else { Swal.fire('Error', res.message, 'error'); } }); } });
        }
    </script>
}
